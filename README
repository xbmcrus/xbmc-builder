xbmc-builder
============

Build scripts for XBMC and related packages.

forked from AndreyPavlenko/xbmc-builder

1. Создаем директории

mkdir $HOME/ppa
mkdir $HOME/ppa/sources
cd $HOME/ppa/sources
git clone https://github.com/xbmc/xbmc.git
exit

при следуещем построении очистить $HOME/ppa/sources от xbmc
rm -r xbmc

2. Клонируем билд скрипты

mkdir -p $HOME/ppa/builders/xbmc-builder
git clone https://github.com/AndreyPavlenko/xbmc-builder.git $HOME/ppa/builders/xbmc-builder

3. Cоздаём в домашней директории конфигурационный файл 

sudo nano  ~/.build.config

# В этом файле нужно прописать настройки 
# и указываем платформы убунт для сборки amd64 (a для i386 по умолчанию)

GPGKEY='8745EFD0'   'ключ в РРА как пример' 
DEBEMAIL='aap <andrey.a.pavlenko@gmail.com>'  как пример
PPA_URL='https://launchpad.net/~aap/+archive/xbmc-fernetmenta'  как пример
TARGET_PLATFORMS='precise:amd64 quantal:amd64 raring:amd64 saucy:amd64'

: ${MAINTAINER:="$DEBEMAIL"}
: ${BUILDPACKAGE_ARGS:="-k$GPGKEY"}
: ${SOURCES_DIR:="$HOME/ppa/sources"}
: ${PPA_BUILDER:="$HOME/ppa/ppa-builder"}
: ${BASETGZ_DIR:='/var/cache/pbuilder/base'}
: ${APT_CACHE_DIR:='/var/cache/pbuilder/aptcache'}
: ${BUILD_DIR:="/tmp/build/$$"}
: ${DEB_MIRROR:='http://ru.archive.ubuntu.com/ubuntu'}

5. устанавливаем утилиту dput

sudo apt-get install dput

6. создаём dput.cf в домашней директории файл для отправки пакетов в РРА

sudo nano  ~/dput.cf

7. заполняем 

[frodo] 
fqdn = ppa.launchpad.net 
method = ftp 
incoming = ~bigbax/frodo/ubuntu/  --- укажите своё рра
login = anonymous 
allow_unsigned_uploads = 0
  
8. Входим в директорию с .git

cd $HOME/ppa/builders/xbmc-builder/xbmc

9. Собираем

TARGET_PLATFORMS='precise:amd64 quantal:amd64 raring:amd64 saucy:amd64' ./build.sh create

10. Отправляем в РРА 

PPA=рра_указанный_в_build.config ./build.sh upload

11. Если имеется, то делаем предподготовку в своём клоне(форке) github xbmc:

git clone https://github.com/bigbelec/xbmc.git
cd xbmc
git init

12. Переключаемся на нужную ветку гита 

git checkout frodo

13. На запрос 

*** Please tell me who you are.

вводим поочерёдно 

git config --global user.email "логин в github"
git config --global user.name "password" пароль пользователя в самой системе убунту

14. делаем изменения(патчим) в локальном гите

15. индексируем

git add .

16. создаём коммит

git commit -a -m 'pvr: fix channel switch for addons using other stream'

17. отправляем измнения в гит в инете

git push -u https://github.com/bigbelec/xbmc.git

Username for 'https://github.com': bigbelec2014@yandex.ru

Password for 'https://bigbelec2014@yandex.ru@github.com':  пароль в github

18. Работа с своим github для рра-бильдера

cd ~/ppa/sources
git clone -b frodo https://github.com/bigbelec/xbmc.git
cd xbmc
git status

если в ответ frodo, то всё сделано правильно,   и выход

exit

19. У себя в github ресурса также делаем по дефолту например ветвь frodo

20. Меняем в конфигурации ветку для сборки:

sudo nano ~/ppa/builders/xbmc-builder/xbmc/build.sh 

: ${PKG_NAME:='xbmc'}
: ${PKG_EPOCH:='2'}
: ${SRC_URL:='https://github.com/bigbelec/xbmc.git'}
: ${REV:='origin/frodo'}

21. И наконец создаем source.changes для отправки в РРА :

cd ~/ppa/builders/xbmc-builder/xbmc

TARGET_PLATFORMS='precise:amd64 quantal:amd64 raring:amd64 saucy:amd64' ./build.sh create

22. Отправляем source.changes  в своё рра

PPA=рра_указанный_в_build.config ./build.sh upload

например если это ppa:bigbax/frodo , то строка пишется так :

PPA=frodo ./build.sh upload


23. Или если нужно , то отправляем в РРА вручную

# Входим в каталог с сырцами

cd ~/ppa/builders/xbmc-builder/xbmc/distribs/26.10.13/src

dput ppa:bigbax/frodo xbmc_12.2-20398~cf3a9a5-ppa1~precise_source.changes

24. Создаем патч.

git diff > ~/ppa/builders/xbmc-builder/xbmc/debian/patches/strings.patch

25. Прописываем этот патч в debian/patches/series

sudo nano ~/ppa/builders/xbmc-builder/xbmc/debian/patches/series

впишем strings.patch

26. Делаем и отправляем в РРА аддоны :

cd ~/ppa/sources
git clone https://github.com/pipelka/xbmc-addon-xvdr.git
exit

27. Собираем : 

cd ~/ppa/builders/xbmc-builder/xbmc-addon-xvdr
TARGET_PLATFORMS='precise:amd64 quantal:amd64 raring:amd64 saucy:amd64' ./build.sh create
PPA=frodo ./build.sh upload
exit

28 Или вручную отправляем в своё РРА 

cd ~/ppa/builders/xbmc-builder/xbmc-addon-xvdr/distribs/26.10.13/src
dput ppa:bigbax/frodo xbmc-addon-xvdr_0.9.8-361~acd4e14-ppa1~precise_source.changes
